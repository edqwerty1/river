"use strict";angular.module("river",["ngAnimate","ngCookies","ngSanitize","ngResource","ngRoute","ui.bootstrap"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"app/main/main.html",controller:"MainCtrl",reloadOnSearch:!1}).otherwise({redirectTo:"/"})}]),angular.module("river").directive("stream",function(){return{restrict:"EA",scope:{channelName:"="},templateUrl:"app/components/stream/stream.html",controller:"StreamController",controllerAs:"vm"}}),angular.module("river").controller("StreamController",["$scope","twitchDataService","$sce",function(e,n,a){var t=this,r=function(e){return t.title=e,n.getStream(e).then(function(e){return t.streamUrl=a.trustAsResourceUrl("http://www.twitch.tv/"+e.stream.channel.name+"/embed"),t.stream},function(e){t.error=e}),t.stream};r(e.channelName)}]),angular.module("river").directive("sideBar",function(){return{restrict:"EA",scope:{},templateUrl:"app/components/sidebar/sidebar.html",controller:"SidebarController",controllerAs:"sidebar"}}),angular.module("river").controller("SidebarController",["twitchDataService","selectedGameService",function(e,n){var a=this;a.channels=[],n.gameChanged.then(function(){},function(){},function(n){e.getChannels(n).then(function(e){var n=e.streams;a.channels=[],angular.forEach(n,function(e){var n=e.channel,t=e.preview;a.channels.push({name:n.name,displayName:n.display_name,previewUrl:t.medium,status:n.status,viewers:e.viewers,selected:!1})})})}),n.getGame()}]),angular.module("river").directive("navBar",function(){return{restrict:"EA",scope:{},templateUrl:"app/components/navbar/navbar.html",controller:"NavbarController",controllerAs:"vm"}}),angular.module("river").controller("NavbarController",["twitchDataService","selectedGameService",function(e,n){var a=this;a.navCollapsed=!0,a.topGames=[],a.test="test",e.getTopGames().then(function(e){{var n=e.top,t=!0;n[0].game.name}angular.forEach(n,function(e){var n=e.game;a.topGames.push({name:n.name,logo:n.logo.medium,selected:t}),t&&(t=!1)})}),a.selectGame=function(e){angular.forEach(a.topGames,function(e){e.selected&&(e.selected=!1)}),e.selected=!0,n.updateSelectedGame(e.name)}}]),angular.module("river").directive("channelPreview",["selectedGameService",function(e){return{restrict:"EA",scope:{channel:"="},templateUrl:"app/components/directives/channel-preview.html",link:function(n){n.selectChannel=function(n){n.selected?e.removeChannel(n.name):e.updateSelectedChannel(n.name),n.selected=!n.selected}}}}]),function(){function e(e,n){function a(){var a=new n.defer;return e.jsonp("https://api.twitch.tv/kraken/games/top?callback=JSON_CALLBACK").success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise}function t(a){var t=new n.defer;return e.jsonp("https://api.twitch.tv/kraken/search/streams?q="+encodeURI(a)+"&callback=JSON_CALLBACK").success(function(e){t.resolve(e)}).error(function(e){t.reject(e)}),t.promise}function r(a){var t=new n.defer;return e.jsonp("https://api.twitch.tv/kraken/streams/"+encodeURI(a)+"?callback=JSON_CALLBACK").success(function(e){t.resolve(e)}).error(function(e){t.reject(e)}),t.promise}var l={getTopGames:a,getChannels:t,getStream:r};return l}var n="twitchDataService";angular.module("river").factory(n,["$http","$q",e])}(),function(){function e(e,n,a){function t(e){n.search("game",e),s.notify(e)}function r(e){-1==d.indexOf(e)&&d.push(e),n.search("channel",d),o.notify(e)}function l(e){var a=d.indexOf(e);-1!==a&&d.splice(a,1),n.search("channel",d),v.notify(e)}function i(){var e=a.game;void 0!==e&&""!==e&&s.notify(e)}function c(){var e=a.channel;void 0!==e&&e!==[]&&angular.forEach(e,function(e){o.notify(e)})}var s=e.defer(),o=e.defer(),v=e.defer(),d=[],m={gameChanged:s.promise,channelChanged:o.promise,channelRemoved:v.promise,updateSelectedGame:t,updateSelectedChannel:r,removeChannel:l,getChannel:c,getGame:i};return m}var n="selectedGameService";angular.module("river").factory(n,["$q","$location","$routeParams",e])}(),angular.module("river").controller("MainCtrl",["selectedGameService",function(e){var n=this;n.channels=[],e.channelChanged.then(function(){},function(){},function(e){-1==n.channels.indexOf(e)&&n.channels.push(e),console.log("main added "+e)}),e.channelRemoved.then(function(){},function(){},function(e){var a=n.channels.indexOf(e);-1!==a&&n.channels.splice(a,1),console.log("main removed "+e)}),n.toggleWrapper=function(){$("#wrapper").toggleClass("toggled")},e.getChannel()}]),angular.module("river").run(["$templateCache",function(e){e.put("app/main/main.html",'<div id="wrapper"><div side-bar=""></div><div nav-bar=""></div><div id="page-content-wrapper" ng-controller="MainCtrl as vm"><div class="container-fluid"><div ng-repeat="c in vm.channels"><div class="col-md-6 col-lg-4" stream="" channel-name="c"></div></div><div class="row"><a href="" ng-click="vm.toggleWrapper()" class="btn btn-default" id="menu-toggle">Show Channels</a></div><hr><div class="footer"><p>River, get it, it is made up from lots of streams..</p></div></div></div></div>'),e.put("app/components/directives/channel-preview.html",'<div class="row"><div class="col-sm-6 col-md-4"><div class="thumbnail"><img class="pull-right" ng-src="{{channel.previewUrl}}" alt="{{channel.name}}" ng-click="selectChannel(channel)"><div class="caption"><div>{{channel.selected}}</div><div>{{channel.displayName}}</div><div>{{channel.status}}</div><div>{{channel.viewers}}</div></div></div></div></div>'),e.put("app/components/navbar/navbar.html",'<nav class="navbar navbar-static-top navbar-inverse"><div class="navbar-header"><button type="button" class="navbar-toggle" ng-init="vm.navCollapsed = true" ng-click="vm.navCollapsed = !vm.navCollapsed"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><div class="container-fluid"><div class="collapse navbar-collapse" ng-class="!vm.navCollapsed && \'in\'" ng-click="vm.navCollapsed=true"><ul class="nav navbar-nav"><li ng-repeat="game in vm.topGames" ng-class="{active: game.selected}"><div class="thumbnail"><img class="pull-right" ng-src="{{game.logo}}" alt="{{game.name}}" ng-click="vm.selectGame(game)"><div class="caption"><h3><a href="" ng-click="vm.selectGame(game)">{{game.name}}</a></h3></div></div></li></ul></div></div></nav>'),e.put("app/components/sidebar/sidebar.html",'<div id="sidebar-wrapper"><ul class="sidebar-nav"><li class="sidebar-brand"><a href="#/">River</a></li><ul><li ng-repeat="channel in sidebar.channels" ng-class="{active: channel.selected}"><div channel-preview="" channel="channel"></div></li></ul></ul></div>'),e.put("app/components/stream/stream.html",'<div class="row"><div class="widget wviolet stream-wrapper"><div data-cc-widget-header="" title="{{vm.title}}"></div><div class="widget-content user"><h3>{{vm.title}}</h3><div class="h_iframe"><iframe class="videoplayer" src="{{vm.streamUrl}}" height="400" width="2" frameborder="0" scrolling="no" allowfullscreen=""></iframe></div><div class="widget-foot"><div class="clearfix"></div></div></div></div></div>')}]);